import os
import pandas as pd
import matplotlib.pyplot as plt
from pathlib import Path


def plot_xgb_importances():
  

    results_dir = Path("results")
    results_dir.mkdir(exist_ok=True)


    csv_path = results_dir / "xgb_feature_importances.csv"

 
    df = pd.read_csv(csv_path)


    if "feature" in df.columns:
        col_feature = "feature"
    elif "Variable" in df.columns:
        col_feature = "Variable"
    else:
        raise ValueError(
            f"Impossible to find the column of features in {df.columns}"
        )

    if "importance" in df.columns:
        col_importance = "importance"
    elif "Importance" in df.columns:
        col_importance = "Importance"
    else:
        raise ValueError(
            f"Impossible to find the column of features in {df.columns}"
        )


    df_sorted = df.sort_values(col_importance, ascending=False)

  
    plt.figure(figsize=(8, 5))
    plt.barh(df_sorted[col_feature], df_sorted[col_importance])
    plt.gca().invert_yaxis()  

    plt.xlabel("Importance")
    plt.title("XGBoost Feature Importances")


    for i, imp in enumerate(df_sorted[col_importance]):
        plt.text(imp + 0.001, i, f"{imp:.3f}", va="center")

    plt.tight_layout()


    output_path = results_dir / "xgb_feature_importances_plot.png"
    plt.savefig(output_path, dpi=300)
    print(f"üìÅ Graphs saved in : {output_path}")

    plt.show()


if __name__ == "__main__":
    plot_xgb_importances()
